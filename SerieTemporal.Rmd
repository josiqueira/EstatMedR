--- 
title: "Análise de Série Temporal Aplicada à Medicina"
subtitle: ""
author: |
  | José Siqueira (siqueira@usp.br)
date: "`r format(Sys.time(), format='%d %B %Y %H:%Mh')`"
output:
  html_document:
    font_adjustment: 1
    css: style.css
    df_print: tibble
    footer: "SerieTemporal.Rmd"
    highlight: pygments
    theme: cerulean
    number_sections: no
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: yes
      smooth_scroll: no
  slidy_presentation:
    font_adjustment: -1
    css: style.css
    footer: "SerieTemporal.Rmd"
    highlight: pygments
    theme: cerulean
    df_print: tibble
    number_sections: no
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: yes
      smooth_scroll: no
---

```{r set-options, echo=FALSE}
options(width = 80)
```

```{css, echo=FALSE}
.code {
  font-size: 18px;
  background-color: white;
  border: 2px solid darkgray;
  font-weight: bold;
  max-width: none !important;
}
.output {
  font-size: 16px;
  background-color: white;
  border: 1px solid black;
  font-weight: bold;
  max-width: none !important;
}
.main-container {
  max-width: none !important;
 }
pre {
  max-height: 500px !important;
  overflow-y: auto !important;
  overflow-x: scroll !important;
 }
.bgobs {
  background-color: #a0d8d8;
 }
.bgcodigo {
  background-color: #eeeeee;
 }
.bgsaida {
  background-color: #ecf7db;
 }
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval=TRUE,
                      echo=TRUE, 
                      fig.width=7, 
                      fig.height=6,
                      fig.align="center",
                      comment=NA,
                      class.source="code",
                      class.output="output")
```

```{r eval=TRUE, echo=FALSE}
systoper <- Sys.info()[[1]]
if (systoper == "Linux")
{
  # Troque para o executavel de onde esta instalado o scilab em seu computador
  executable <- file.path("","home","silveira","Scilab","bin","scilab")
  parameter <- "-nw"
}
# Windows
if (systoper == "Windows")
{
  # Troque para o executavel de onde esta instalado o scilab em seu computador
  executable <- file.path("D:", "Usuarios", "Jose", "scilab2023", "bin", "Scilex")
  parameter <- ""
}
```

```{r,eval=TRUE,echo=FALSE}
eng_scilab <- function(options) {
code <- stringr::str_c(options$code, collapse = '\n')
if (options$eval) 
{
  cmd <- sprintf("%s %s -e %s",
                 executable,
                 parameter,
                 shQuote(code,type="cmd"))
  out <- system(cmd, intern = TRUE)
}else{out <- "output when eval=FALSE and engine='scilab'"}

knitr::engine_output(options, options$code, out)

}

knitr::knit_engines$set(scilab=eng_scilab)
```

```{r}
invisible(Sys.setlocale("LC_CTYPE", "pt_BR.UTF-8"))
invisible(Sys.setlocale("LC_ALL", "pt_BR.UTF-8"))
```

<!-- # Incorporar -->

<!-- * Wickramasinghe,W.M.A., Athukorala, P.P.A.W., Senarathne, -->
<!-- S.G.J. and Yapa, Y.P.R.D. (2023) Examine the Reliability of Econometrics Software: An Empirical Comparison of Time Series Modelling. Open Journal of Statistics, 13, 25-45. https://doi.org/10.4236/ojs.2023.131003 -->
<!--   * "he study revealed that the results produced by three software packages for the same dataset and the same lag order vary significantly." -->

<!-- * Mair, P (2018) _Modern psychometrics with R_. USA: Springer. Chapter 13: Modeling trajectories and time series; Chapter 14: Analysis of fMRI data.  -->

<!-- * ANTUNES, José Leopoldo Ferreira  e  CARDOSO, Maria Regina Alves. Uso da análise de séries temporais em estudos epidemiológicos. Epidemiol. Serv. Saúde [online]. 2015, vol.24, n.3 [citado  2023-02-12], pp.565-576. Disponível em: <http://scielo.iec.gov.br/scielo.php?script=sci_arttext&pid=S1679-49742015000300024&lng=pt&nrm=iso>. ISSN 1679-4974. -->

<!-- * <pre>D:\Usuarios\Jose\Documents\PSE\PSE5898\Aula 8 - Analise de series temporais - SARIMA e funcao de transferencia\TimeSeRies</pre>  -->

<!-- * https://en.wikipedia.org/wiki/Transfer_function -->

<!-- * A Very Short Course on Time Series Analysis, Roger D. Peng, 2020: https://bookdown.org/rdpeng/timeseriesbook/the-fourier-transform.html -->

<!-- * Real longitudinal data analysis for real people - Building a good enough mixed model - Cheng et al - 2009 -->

<!-- * How to analyze linguistic change using mixed models, Growth Curve Analysis and Generalized Additive Modeling - Winter & Wieling - 2016 -->

<!-- * Time Series Analysis in R: https://www.geeksforgeeks.org/time-series-analysis-in-r/#article-meta-div -->

<!-- * Pinedo, D  (2020) Time series analysis in R. -->
<!-- https://rpubs.com/odenipinedo/time-series-analysis-in-R -->

<!-- * Date, time and time series in R: https://www.geo.fu-berlin.de/en/v/soga/Introduction-to-R/Dates-times-and-time-series-in-R/index.html -->

<!-- * Package ‘timeSeries’ -->

<!-- * Derryberry, DR (2014) _Basic data analysis for time series with R_. NJ: Wiley. Chapter 12: FITTING FOURIER SERIES. -->

<!-- * Time Series Analysis and Its Applications: With R Examples (4th ed), by R.H. Shumway and D.S. Stoffer. Springer Texts in Statistics, 2017, <DOI:10.1007/978-3-319-52452-8> -->

<!-- * Package ‘astsa’ -->

<!-- * Shumway, RH & Stoffer, DS (2019) _Time series: A data analysis approach using R_. USA: Chapman-Hall.  -->
<!--   * Example 1.6. fMRI Imaging: `astsa::fmri` -->
<!--   * Chapter 3: tsplot(cmort, main="Cardiovascular Mortality", col=culer[1], -->
<!-- type="o", pch=19, ylab="") -->
<!-- tsplot(tempr, main="Temperature", col=culer[2], type="o", pch=19, -->
<!-- ylab="") -->
<!-- tsplot(part, main="Particulates", col=culer[3], type="o", pch=19, -->
<!-- ylab="") -->

<!-- * Analysis of Integrated and Cointegrated Time Series with R - Pfaff - Springer - 2008. pacote vars: https://www.pfaffikus.de/rpacks/  -->

<!-- * Rob J Hyndman and George Athanasopoulos. Forecasting: Principles and Practice 3rd ed.  https://otexts.com/fpp3/ . pacote `fpp3` -->

<!-- * Fundamentals of Applied Statistics - 4e - Gupta & Kapoor.pdf -->
<!--   * Cap. 2: Analysis if time series -->

<!-- * https://online.stat.psu.edu/stat510/lesson/9/9.1 : 9.1 Pre-whitening as an Aid to Interpreting the CCF: https://online.stat.psu.edu/stat510/ -->
<!--   * Package ‘sarima’ -->
<!--   * https://spureconomics.com/arima-and-sarima-in-rstudio/ -->
<!--   * https://rpubs.com/Nikita-25/jj-sarima-model -->
<!--   * library(astsa): astsa::sarima -->

<!-- * Box & Jenkins com função de transferência usando o R - Ferreira et al - 2015.pdf -->

<!-- * Displaying Time Series, Spatial, and Space-Time Data with R - Lamigueiro - 2014.pdf -->

# Conteúdo

* Modelo SARIMA
* Função de transferência: SARIMAX
* Análise de intervenção

# O que é série temporal?

Série temporal ou sucessão cronológica é uma sequência numérica indexada equispaçadamente no tempo com pelo menos 50 observações.

Cada série é uma variável intervalar com medidas repetidas: delineamento intraparticipantes de sujeito-único.

Objetivo: prever fora do domínio de observação (extrapolação) usando uma combinação linear de valores anteriores.

# Análise de série temporal: Saúde e R

## Questões 

Como simplificar e tornar mais fácil a compreensão de Análise de Série Temporal/ Sucessão Cronológica para a área da Saúde?

Qual a relevância da Análise de Série Temporal para a área da saúde?

## Respostas

Para simplificar a análise de dados da área da saúde, decidiu-se pelo uso do R, pois:

* Software livre e gratuito; 
* Disponível para LINUX, Windows e MacOSX;
* Muitos pacotes desenvolvidos em R de boa qualidade para analisar dados da área da saúde;
* Expectativa dessa situação continuar por um longo período;
* Scripts R desenvolvidos pelo autor para realizar procedimentos específicos. 

Para simplificar a exposição da Análise de Série Temporal, ela é exposta de maneira concisa e são usados exemplos com dados observados para mostrar sua aplicação na área da saúde.

A importância Análise de Série Temporal aumentou substancialmente nos últimos anos, pois:

* Há mais dados secundários da área da saúde disponíveis pela internet numa frequência cada vez maior;
* Hardware e software de Análise de Série Temporal mais poderosos e amigáveis;
* Internet facilita baixar dados e softwares livres e gratuitos.

# Econometria Financeira para dados de baixa frequência (diária ou superior) 

* A sequência de valores é série temporal, pois os valores são equiespaçados
* Série temporal do retorno segue processo NIID/ GWN
* Analisar principalmente as relações “causais” entre séries temporais (precedência temporal por meio do método de causalidade de Granger) com o uso de cointegração, VAR e VEC
* As séries macroeconômicas raramente passam das poucas centenas de observações (quando, na melhor das hipóteses, se têm observações mensais) e, em geral, a quantidade de dados é insuficiente para os testes econométricos poderosos
* Dados de baixa qualidade
* Séries com periodicidades distintas, em geral

# Pacote R

```{r eval=TRUE,  echo=TRUE, warning=FALSE, error=FALSE}
options(warn=-1)
suppressMessages(library(knitr, warn.conflicts=FALSE))
suppressMessages(library(forecast, warn.conflicts=FALSE))
suppressMessages(library(TSA, warn.conflicts=FALSE))
suppressMessages(library(astsa, warn.conflicts=FALSE))
suppressMessages(library(zoo, warn.conflicts=FALSE))
suppressMessages(library(dplyr, warn.conflicts=FALSE))
suppressMessages(library(ggplot2, warn.conflicts=FALSE))
suppressMessages(library(ggfortify, warn.conflicts=FALSE))
suppressMessages(library(changepoint, warn.conflicts=FALSE))
suppressMessages(library(strucchange, warn.conflicts=FALSE))
suppressMessages(library(readxl, warn.conflicts=FALSE))
suppressMessages(library(timeSeries, warn.conflicts=FALSE))
suppressMessages(library(MTS, warn.conflicts=FALSE))
suppressMessages(library(vars, warn.conflicts=FALSE))
suppressMessages(library(urca, warn.conflicts=FALSE))
suppressMessages(library(aTSA, warn.conflicts=FALSE))
suppressMessages(library(smooth, warn.conflicts=FALSE))
suppressMessages(library(KernSmooth, warn.conflicts=FALSE))
suppressMessages(library(estimatr, warn.conflicts=FALSE))
suppressMessages(library(tscount, warn.conflicts=FALSE))
suppressMessages(library(DescTools, warn.conflicts=FALSE)) # DescTools::ShapiroFranciaTest()
suppressMessages(library(trend, warn.conflicts=FALSE))
```

# Repositório de dados

## Geral

Time series - UCI Machine Learning Repository: https://archive.ics.uci.edu/ml/datasets.php?format=&task=&att=&area=&numAtt=&numIns=&type=ts&sort=nameUp&view=table

## Saúde

DATASUS: 
https://datasus.saude.gov.br/transferencia-de-arquivos/

IBGE - PNS - Pesquisa Nacional de Saúde: https://www.ibge.gov.br/estatisticas/sociais/saude/29540-2013-pesquisa-nacional-de-saude.html?edicao=9163&t=resultados

REDCap:
https://redcapbrasil.com.br/

National Center for Health Statistics: https://www.cdc.gov/nchs/data_access/ftp_data.htm

HealthData.gov: 
https://beta.healthdata.gov/browse

Health Statistics & Data: https://guides.lib.berkeley.edu/publichealth/healthstatistics/usingstats

World Health Organization data collections: https://www.who.int/data/collections

National Cancer Institute: The Surveillance, Epidemiology, and End Results (SEER) Program
https://seer.cancer.gov/
https://nccrexplorer.ccdi.cancer.gov/

## Sociodemográfico

OECD.Stat:
http://stats.oecd.org/ 

IPEA data:
http://www.ipeadata.gov.br

General Social Survey:
https://gss.norc.org/

## Econômico-financeiro

Finding and using financial data at Princeton University:
http://libguides.princeton.edu/c.php?g=84125&p=541948

GoogleFinanças:
https://www.google.com/finance

Yahoo!Finanças:
http://br.finance.yahoo.com

CBOE DataShop:
http://www.marketdataexpress.com/default.aspx

IVolatility DataTools|Data Download Services:
http://www.ivolatility.com/data_download.j

Banco Central do Brasil:
http://www.bcb.gov.br/htms/selic/selicdiarios.asp 

# Análise de sujeito único

```{r eval=TRUE, echo=FALSE, out.width="90%", fig.cap="Morley, 2018, Chapter 5"}
knitr::include_graphics("Visual.png")
```

* Morley, S (2018) _Single-case methods in clinical psychology: A practical guide_. NY: Routledge. Chapter 5: Visual analysis if single-case data; Chapter 6: Statistical analysis of single-case data.

* Spata, AV (2005) _Métodos de pesquisa: ciências do comportamento e diversidade humana_. RJ: LTC. Capítulo 13: Delineamentos de sujeito único.

* Velicer, WF & Fava, JL (2003) Time series analysis. In Schinka, J & Velicer, WF (Eds.) _Research Methods in Psychology_ (581-606). Volume 2, Handbook of Psychology (Weiner, IB Editor-inChief). NY: Wiley.

* Hamaker, EL (2013) Why researchers should think “within-person”:  A paradigmatic rationale. In Mehl MR &, Conner TS (Eds.) (2013) _Handbook of research methods for studying daily life_. NY: Guilford. p. 43-61.

# Delineamento de série temporal 

* Unidade observacional: individuada e agregada
* Participação do pesquisador: não intervencional ou intervencional
* Temporalidade: longitudinal com medidas equiespaçadas (periódico)

"A essência do delineamento de série temporal é a presença de um processo periódico de medida em algum grupo ou indivíduo e a introdução de uma mudança experimental nessa série temporal de medidas, cujos resultados são indicador por uma descontinuidade nas medidas registradas na série temporal.” 

> Campbell & Stanley, 1969, p. 67

Os delineamentos de séries temporais, em que uma mesma área ou população (unidade observacional agregada), é estudada em momentos distintos e periódicos de tempo (e.g., anualmente), são classificados como um subtipo de estudo ecológico (ecológico temporal), sendo que cada unidade de tempo consiste numa unidade ecológica completa.

O estudo com delineamento ecológico tem a capacidade de gerar hipótese temporal. 

"Um estudo ecológico centra-se na comparação de grupos, em vez de indivíduos. As variáveis em uma análise ecológica podem ser medidas agregadas, medidas ambientais ou medidas globais. O propósito de uma análise ecológica pode ser fazer inferências biológicas sobre os efeitos nos riscos individuais ou fazer inferências ecológicas sobre os efeitos nas taxas de grupo. Os delineamentos de estudos ecológicos podem ser classificados em duas dimensões: (a) se o grupo primário é medido (estudo exploratório versus analítico); e (b) se os sujeitos são agrupados por local (estudo de grupo múltiplo), por tempo (estudo de tendência temporal) ou por local e tempo (estudo misto). Apesar de várias vantagens práticas dos estudos ecológicos, existem muitos problemas metodológicos que limitam severamente a inferência causal, incluindo viés ecológico e de nível cruzado, problemas de controle de fatores de confusão, classificação incorreta dentro do grupo, falta de dados adequados, ambiguidade temporal, colinearidade e migração entre grupos."

> Morgenstern, 1995, resumo

"Estudo exploratório de série temporal: Um estudo exploratório de tendência temporal ou de série temporal envolve uma comparação das taxas de doença ao longo do tempo em uma população geograficamente definida. Além de fornecer gráficos de tendências temporais, os dados de séries temporais também podem ser usados para prever taxas e tendências futuras. Esta última aplicação, que é mais comum nas ciências sociais do que na epidemiologia, geralmente envolve ajustar os dados de desfecho por modelo de média móvel integrado autorregressivo (ARIMA) (30, 48). O método de modelagem ARIMA também pode ser estendido para avaliar o impacto de uma intervenção populacional (43), para estimar associações entre duas ou mais variáveis de séries temporais (7, 48) e para estimar associações em um delineamento ecológico misto (60; Veja abaixo).
Um tipo especial de análise exploratória de tendência temporal frequentemente usada por epidemiologistas é a análise de idade-período-coorte (ou coorte). Por meio de gráficos ou técnicas de modelagem formal, o objetivo desta abordagem é estimar os efeitos separados de três variáveis dependentes do tempo na taxa de doença: idade, período (tempo do calendário) e coorte de nascimento (ano de nascimento) (32, 35). Por causa da dependência linear dessas três variáveis, há uma limitação (problema de identificação) com a interpretação dos resultados da coorte idade-período. O problema é que cada conjunto de dados tem explicações alternativas em relação à combinação de efeitos de idade, período e coorte; não há um conjunto único de parâmetros de efeito quando todas as três variáveis são consideradas simultaneamente.
A única maneira de decidir qual interpretação deve ser aceita é considerar os achados à luz do conhecimento prévio e, possivelmente, restringir o modelo ignorando um efeito.
Lee et al. (40) conduziram uma análise de idade-período-coorte da mortalidade por melanoma entre homens brancos nos EUA entre 1951 e 1975. Eles concluíram que o aparente aumento na taxa de mortalidade por melanoma era devido principalmente a um efeito de coorte. Ou seja, as pessoas nascidas em anos mais recentes experimentaram ao longo de suas vidas uma taxa mais alta do que as pessoas nascidas mais cedo. Em um artigo subsequente, Lee (39) especulou que esse efeito de coorte pode refletir aumentos na exposição à luz solar ou queimaduras solares durante a juventude.

Estudo analítico de série temporal: Neste tipo de estudo de tendência temporal, avaliamos a associação ecológica entre mudança no nível médio de exposição ou prevalência e mudança na taxa de doença em uma população geograficamente definida. Assim como nos projetos exploratórios, esse tipo de avaliação pode ser feito por simples gráficos ou por modelagem de regressão de séries temporais (por exemplo, 48). Com qualquer uma das abordagens, no entanto, a interpretação dos resultados é muitas vezes complicada por dois problemas. Primeiro, as mudanças na classificação da doença e nos critérios diagnósticos podem produzir resultados muito enganosos. Em segundo lugar, a latência da doença em relação à exposição primária pode ser longa, variável entre os casos ou simplesmente desconhecida. Assim, empregar uma defasagem arbitrária entre as observações - ou uma defasagem empiricamente definida que maximize a associação estimada entre as duas tendências - também pode produzir resultados enganosos (28).
Darby & Doll (13) examinaram as associações entre a dose média anual absorvida de precipitação radioativa de testes de armas e a taxa de incidência de leucemia infantil em três países europeus entre 1945 e 1985.
Embora a taxa de leucemia tenha variado ao longo do tempo em cada país, eles não encontraram evidências convincentes de que essas mudanças fossem atribuíveis a mudanças na radiação radioativa."

> Morgenstern, 1995, p. 67-8

"Discussão: Quase meio século atrás, Bereiter (1963) escreveu em seu capítulo de abertura do livro Problems in Measuring Change: “Embora seja comum que a pesquisa seja bloqueada por alguma dificuldade na metodologia experimental, realmente não há muitos exemplos nas ciências comportamentais de questões promissoras que não foram pesquisadas devido a deficiências na metodologia estatística. Questões que tratam de mudanças psicológicas podem muito bem constituir as exceções mais importantes ”(p. 3). Desde a introdução da modelagem da curva de crescimento latente, esse obstáculo metodológico estatístico foi amplamente superado no que diz respeito aos processos de desenvolvimento. No entanto, só muito recentemente estamos testemunhando o surgimento de soluções para o estudo de processos estacionários.
Esta descoberta oportuna e emocionante pode ser parcialmente atribuída a dois desenvolvimentos técnicos recentes. Em primeiro lugar, a introdução de assistentes pessoais digitais, telefones celulares e questionários online facilitou substancialmente a coleta de dados associados à vida diária. Como resultado, mais e mais pesquisadores têm conjuntos de dados que consistem em grandes quantidades de medições repetidas das mesmas pessoas. Em segundo lugar, o maior poder computacional dos computadores permitiu novos e mais complicados modelos de vários níveis pelos quais podemos modelar esses dados longitudinais intensivos. Especificamente, há um novo desenvolvimento que visa a investigação de processos que ocorrem no nível interno, ao mesmo tempo em que toma emprestado a força de outros casos combinando esses modelos internos em novos modelos multiníveis.
Com esses desenvolvimentos técnicos em vigor, espera-se que na próxima década veremos um aumento no desenvolvimento e aplicação de novos modelos multiníveis, que são muito mais adequados às hipóteses específicas que os pesquisadores desejam investigar.
Agora cabe aos pesquisadores determinar quais questões eles realmente desejam investigar e escolher as ferramentas estatísticas apropriadas para responder a essas questões. Por exemplo, pode-se perguntar não apenas se crianças com mais problemas comportamentais aumentam o nível de rejeição em suas mães, mas também se um aumento nos problemas comportamentais de uma criança leva a um aumento na rejeição materna: Embora a primeira questão seja entre pergunta pessoal, a segunda é uma pergunta interna. Em vez de tentar derivar a resposta para a segunda questão investigando o punho, os pesquisadores agora podem escolher o método apropriado para lidar com sua questão de pesquisa.
Os pesquisadores têm feito perguntas pessoais desde o início da psicologia e, por muito tempo, eles não tiveram escolha a não ser fazer a improvável suposição de que os resultados populacionais refletiam fenômenos pessoais. Agora, finalmente, temos acesso a técnicas estatísticas desenvolvidas especificamente para lidar com questões pessoais.
Isso implica que a barreira metodológica estatística que Bereiter apontou há quase 50 anos está sendo totalmente superada e estamos no limiar de uma nova e promissora etapa na pesquisa de processos.”

> Hamaker, 2013

"A compreensão da dinâmica interacional entre vários processos é um dos desafios mais importantes da psicologia e da medicina psicossomática. Os pesquisadores que exploram o comportamento ou outros fenômenos psicológicos lidam principalmente com dados ordinais ou intervalares. Valores ausentes e medições não equidistantes conseqüentes representam um problema geral de estudos longitudinais deste campo. A maioria das metodologias orientadas a processos foi originalmente projetada para dados equidistantes medidos em escalas de razão. Portanto, o objetivo deste artigo é esclarecer as condições para o desempenho satisfatório dos métodos longitudinais com dados típicos da pesquisa psicológica e psicossomática. Este estudo examina o desempenho do teste de Johansen, um procedimento que incorpora um conjunto de técnicas sofisticadas de séries temporais, em referência à qualidade dos dados utilizando o método de Monte Carlo. 
Os principais resultados dos estudos de simulação realizados são: 
(1) As análises de séries temporais requerem amostras de pelo menos 70 observações para uma estimativa e inferência precisas. 
(2) Dados discretos e falhas na equidistância das medições devido a valores irregulares em falta parecem não ser problemáticos. 
(3) As características relevantes de processos estacionários podem ser adequadamente capturadas usando escalas ordinais de 5 ou 7 pontos. 
(4) Para processos de tendências, são necessárias escalas de pelo menos 10 pontos para garantir uma qualidade aceitável de estimativa e inferência."

> Stadnitski, 2020, resumo

"Delineamentos de estudo antes-e-depois são frequentemente usados para quantificar o impacto das intervenções de saúde no nível da população nos processos de cuidado médico e nos desfechos de saúde no nível da população.
Eles contam com o “experimento natural” resultante da implementação das intervenções, dividindo o tempo em períodos de “pré-intervenção” e “pós-intervenção”. No entanto, estudos observacionais baseados em um pequeno número de medições pré e pós-intervenção são propensos a viés, pois não levam em conta as tendências subjacentes pré-existentes de curto e longo prazo. Em contraste, a análise de séries temporais interrompidas (ITS) (também chamada de “análise de intervenção”) é mais robusta, pois controla esses problemas rastreando longitudinalmente o resultado antes e depois de uma intervenção. O ITS é considerado um dos melhores desenhos para estabelecer causalidade quando os ensaios clínicos randomizados (ECR) não são viáveis nem éticos. De fato, quando combinados com uma série de controle, os projetos de ITS geralmente geram resultados semelhantes aos ECR. Vários artigos publicados abordaram o tema do uso de abordagens de ITS para avaliar intervenções de saúde. No entanto, eles se concentraram principalmente na regressão segmentada, a forma mais simples de análise de ITS.
Modelos de regressão segmentada usam o tempo como preditor variável; um modelo de regressão segmentado simples pode ser expresso como:

$$Y_t = \alpha+\beta_1 \; \text{time} +\beta_2\; \text{intervention} + 
\beta_3 \;\text{time since intervention} + \epsilon_t$$

Sendo que $Y_t$ é o resultado em um determinado momento ($t$), a variável _time_ representa o tempo desde o início do período de estudo, a variável _intervention_ indica se o tempo $t$ é antes (0) ou após (1) a implementação da intervenção, e a variável _time since intervention_ representa o tempo decorrido desde a implementação da intervenção, tendo o valor 0 antes da intervenção. Uma suposição chave da regressão linear é que os erros (resíduos) são independentes e não correlacionados. No entanto, esta suposição é frequentemente violada com séries temporais.
A abordagem de regressão segmentada é mais apropriada quando uma série temporal tem uma tendência linear ou de outra forma facilmente modelada e resíduos distribuídos independentemente.
Na prática, os padrões nos dados podem ser pouco claros ou difíceis de identificar, com variação considerável. Assim, algumas séries temporais podem não ser passíveis de regressão segmentada devido à dificuldade em modelar a estrutura de autocorrelação. Uma alternativa à regressão segmentada são os modelos Autoregressive Integrated Moving Average (ARIMA).
Os modelos ARIMA diferem da regressão segmentada, pois o resultado $Y_t$ é regredido apenas no resultado medido em pontos de tempo anteriores (não no próprio tempo). No entanto, há pouca orientação na literatura sobre como ajustar esses modelos no contexto de análise de ITS. Dada a quantidade e complexidade dos dados de saúde que estão sendo coletados e disponibilizados para pesquisa, o ARIMA tornou-se uma ferramenta cada vez mais útil para pesquisadores interessados em avaliar intervenções em grande escala.
Neste artigo, descreveremos a teoria subjacente por trás dos modelos ARIMA e como eles podem ser usados para avaliar intervenções em nível populacional, como a introdução de políticas de saúde, ilustradas usando um exemplo de introdução de uma política de saúde para impedir a prescrição inadequada de quetiapina, um antipsicótico, na Austrália."

> Schaffer et al., 2021, p. 1-2

# Livros de análise de série temporal

```{r eval=TRUE, echo=FALSE, out.width="50%", fig.cap="2015"}
knitr::include_graphics("TSA5.png")
```

<br>

```{r eval=TRUE, echo=FALSE, out.width="90%", fig.cap="Livros de referência de análise de série temporal"}
knitr::include_graphics("TSBooks.png")
```

<br> 

```{r eval=TRUE, echo=FALSE, out.width="50%", fig.cap="Livro didático de análise de série temporal"}
knitr::include_graphics("TSBook_Enders.png")
```

# Método de Box-Jenkins

Na prática, raramente encontra-se uma série exatamente conforme um correlograma ACF ou PACF teóricos.

As ambiguidades do método de Box-Jenkins podem levar dois igualmente bons econometristas a estimar e prever uma série usando processos SARIMA bem diferentes.

É prudente evitar o uso de séries já dessazonalizadas.

O gráfico de sequência fornece informações úteis a respeito de outliers, missing values e quebras estruturais.

A ideia fundamental da abordagem de Box-Jenkins é o princípio da parcimônia, pois modelos parcimoniosos preveem melhor que modelos superparametrizados.

Um modelo parcimonioso tem poucos parâmetros e é bem ajustado aos dados.

Quando menor o BIC, mais parcimonioso é o modelo.

Muitos veem a necessidade de julgamento e da experiência do econometrista como uma séria deficiência de um procedimento que é projetado para ser científico.

Conforme Enders (2015), o método de Box_Jenkins é melhor aprendido por meio da experiência, pois análise de série temporal é mais uma arte do que uma ciência.

# Airline passengers, 1949 to 1960: `AirPassengers{datasets}`

The classic Box, Jenkins & Reinsel (2008) airline data. 

```{r eval=TRUE, echo=TRUE}
library(ggfortify)
Dados <- datasets::AirPassengers
print(Dados)
class(Dados)
str(Dados)

plot(1:length(Dados), Dados, type="p", cex=.5, xlab="Mês", 
     main="Airline passengers, 1949 to 1960",
     ylab="Número de passageiros x 10^3", col="black")
lines(1:length(Dados), Dados, type="l", col="gray")
bw <- KernSmooth::dpill(1:length(Dados), Dados, gridsize=length(Dados))
lp <- KernSmooth::locpoly(1:length(Dados), Dados, 
                          bandwidth=bw, 
                          gridsize=length(Dados))
smooth <- lp$y
lines(1:length(Dados), smooth, type="l", lty=3)
summary(Dados)
forecast::tsoutliers(Dados)
acf(Dados)
pacf(Dados)

cpm <- changepoint::cpt.mean(Dados)
print(summary(cpm))
plot(cpm)
ggplot2::autoplot(cpm)
cpv <- changepoint::cpt.var(Dados)
print(summary(cpv))
plot(cpv)
ggplot2::autoplot(cpv)
sc <- strucchange::breakpoints(Dados~1)
print(sc)
ggplot2::autoplot(sc)

plot(1:length(Dados), Dados, type="p", cex=.5, 
     ylim=c(min(Dados)*0.95,max(Dados)*1.05),
     main="Airline passengers, 1949 to 1960",
     xlab="Mês", 
     ylab="Número de passageiros x 10^3", col="black")
lines(1:length(Dados), Dados, type="l", col="gray")
for(i in 1:length(sc$breakpoints)) abline(v=sc$breakpoints[i], lty=2)
segments(0, cpm@param.est$mean[1], 
         cpm@cpts[1], cpm@param.est$mean[1],
         col="black")
segments(cpm@cpts[1], cpm@param.est$mean[2], 
         cpm@cpts[2], cpm@param.est$mean[2],
         col="black")
print(cpm@param.est$mean)

bw <- KernSmooth::dpill(1:length(Dados), Dados, gridsize=length(Dados))
lp <- KernSmooth::locpoly(1:length(Dados), Dados, 
                          bandwidth=bw, 
                          gridsize=length(Dados))
smooth <- lp$y
lines(1:length(Dados), smooth, type="l", lty=1, lwd=1.5)
# https://www.mssqltips.com/sqlservertip/6778/time-series-forecasting-methods-with-r-examples/
fts <- forecast::snaive(Dados, h=60)
summary(fts)
plot(fts)
fts <- smooth::sma(Dados, order=3)
print(fts)
fc <- forecast::forecast(fts)
print(fc)
plot(fc)
Box.test(Dados)
# https://stats.stackexchange.com/questions/104215/difference-between-series-with-drift-and-series-with-trend
print(aTSA::trend.test(Dados)) # H0: ausência de tendência
# https://otexts.com/fpp3/stationarity.html
print(trend::cs.test(Dados)) 
print(trend::mk.test(Dados)) 
print(trend::sens.slope(Dados)) 
print(tseries::adf.test(Dados)) # H0: não estacionária (tipo 3)
plot(diff(log(Dados)))
print(aTSA::trend.test(diff(log(Dados)))) # H0: ausência de tendência
# https://otexts.com/fpp3/stationarity.html
print(trend::cs.test(diff(log(Dados)))) 
print(trend::mk.test(diff(log(Dados)))) 
print(trend::sens.slope(diff(log(Dados)))) 
Box.test(diff(log(Dados)))
print(tseries::adf.test(diff(log(Dados)))) # H0: não estacionária (tipo 3)
plot(decompose(Dados))
plot(Dados, col="gray", main="Dados brutos e dessazonalizados")
ds <- forecast::seasadj(decompose(Dados,"multiplicative"))
lines(ds)
plot(diff(log(ds)))
print(aTSA::trend.test(diff(log(ds)))) # H0: ausência de tendência
# https://otexts.com/fpp3/stationarity.html
print(trend::cs.test(diff(log(ds)))) 
print(trend::mk.test(diff(log(ds)))) 
print(trend::sens.slope(diff(log(ds)))) 
Box.test(diff(log(ds)))
print(tseries::adf.test(diff(log(ds)))) # H0: não estacionária (tipo 3)
```

# Bronquiolite

```{r eval=TRUE, echo=FALSE, out.width="90%", fig.cap="Cunha, GZ (2016) _Modelos de séries temporais para dados de contagem_. Dissertação de mestrado do PBE-UEM."}
knitr::include_graphics("Bronquiolite.png")
```

# COVID-19

```{r eval=TRUE, echo=FALSE, out.width="90%", fig.cap="Modelagem Matemática do COVID-19: Atualização de 19.06.2020: https://wp.ufpel.edu.br/fentransporte/2020/06/19/modelagem-matematica-do-covid-19-atualizacao-de-19-06-2020/"}
knitr::include_graphics("COVID100.png")
```

# Tabagismo: Padrão 

```{r eval=TRUE, echo=FALSE, out.width="70%", fig.cap="Velicer & Fava (2003)"}
knitr::include_graphics("SmokingPatterns.png")
```

```{r eval=TRUE, echo=TRUE}
Dados <- readxl::read_excel("Cigarros.xlsx", sheet="ncigarros")
print(Dados)
class(Dados)
str(Dados)
Dados <- subset(Dados, select=c(ncigROD))
Dados <- ts(data=Dados)
plot(Dados)
print(Dados)
class(Dados)
str(Dados)
plot(1:length(Dados), Dados, type="p", cex=1, xlab="Dia", 
     ylab="Numero de cigarros", col="black")
lines(1:length(Dados), Dados, type="l", col="gray")
bw <- KernSmooth::dpill(1:length(Dados), Dados, gridsize=length(Dados))
lp <- KernSmooth::locpoly(1:length(Dados), Dados, 
                          bandwidth=bw, 
                          gridsize=length(Dados))
smooth <- lp$y
lines(1:length(Dados), smooth, type="l", lty=3)
# lines(ksmooth(1:length(Dados), Dados,
#               kernel="normal",
#               bandwidth=bw),
#       type='l', col='black', lty=2)
forecast::tsoutliers(Dados)
```

# Tabagismo: Correlograma

```{r eval=TRUE, echo=TRUE}
Dados <- readxl::read_excel("Cigarros.xlsx", sheet="ncigarros")
print(Dados)
plot(Dados$Dia, Dados$ncigROD, ylim=c(0,17), 
     xlab="Dia", ylab="Numero de cigarros", main="ROD")
lines(Dados$Dia, Dados$ncigROD, type="l", col="gray")
Dados <- cbind(Dados,
               dplyr::lag(Dados[,2], n=1), 
               dplyr::lag(Dados[,2], n=2),
               dplyr::lag(Dados[,2], n=3),
               dplyr::lag(Dados[,2], n=4),
               dplyr::lag(Dados[,2], n=5))
print(Dados)
Dados <- na.omit(Dados)
n <- length(Dados)
# https://www.datacamp.com/tutorial/autocorrelation-r
round(cor(Dados[,2:7])[1,2:6]*(n-1)/n,2)
```

```{r eval=TRUE, echo=FALSE, out.width="70%", fig.cap="Velicer & Fava (2003): Figure 23.4"}
knitr::include_graphics("Correlograma.png")
```

```{r eval=TRUE, echo=TRUE}
Dados <- readxl::read_excel("Cigarros.xlsx", sheet="ncigarros")
Dados <- subset(Dados, select=c(ncigROD))
Dados <- ts(data=Dados)
acf.est <- acf(Dados, plot=FALSE)
print(acf.est)
pacf.est <- pacf(Dados, plot=FALSE)
print(pacf.est)
plot(1:(length(acf.est$acf)), acf.est$acf[1:length(acf.est$acf)], type="l", col="gray",
     xlab="lag", ylab="Correlacao", main="Correlograma", ylim=c(-1,1))
lines(1:length(pacf.est$acf), pacf.est$acf, type="l", "black")
abline(h=0, lty=2)
abline(v=1, lty=2)
legend("topright", legend=c("ACF","PACF"), 
       lty=c(1,1), col=c("gray", "black"), bty="n")
plot(acf.est, ylim=c(-1,1))
plot(pacf.est, ylim=c(-1,1))
```

# Tabagismo: Previsão

```{r eval=TRUE, echo=TRUE}
# https://www.mssqltips.com/sqlservertip/6778/time-series-forecasting-methods-with-r-examples/
fts <- forecast::naive(Dados, h=7)
print(fts)
plot(fts)
fts <- smooth::sma(Dados, order=3, h=7)
print(fts)
fc <- forecast::forecast(fts)
print(fc)
plot(fc)
```

# Airline passengers: SARIMA

```{r eval=TRUE, echo=TRUE}
Dados <- datasets::AirPassengers
# Fit model to first few years of AirPassengers data
aa <- forecast::auto.arima(window(AirPassengers, end=1956+11/12))
summary(aa)
Box.test(aa$residuals)
lmtest::coeftest(aa)
air.model <- forecast::Arima(window(Dados, 
                                    end=1956+11/12), 
                             order=c(0,1,1), 
                             seasonal=list(order=c(0,1,1), 
                                           period=12), 
                             lambda=0) # Box-Cox transformation
summary(air.model)
lmtest::coeftest(air.model)
ggplot2::autoplot(air.model) 
plot(forecast::forecast(air.model,h=48)) # Apply fitted model to later data
lines(Dados)
Box.test(air.model$residuals)
```

# Modelo SARIMA

Seasonal Autoregressive Integrated Moving Average

Modelo SARIMA da quantidade de passageiros da companhia aérea

Modelo Airline de Newbold & Bos (1990)

**SARIMA(p,d,q)(P,D,Q)~s~**  

* Autorregressividade de ordem p: p valores anteriores influenciam na predição do valor corrente da série
* Média móvel de ordem q: q desvios da média (resíduos) da série anteriores influenciam na predição do valor corrente da série
* Diferença finita de ordem d
* Período de sazonalidade s

**Airline Passengers Model: SARIMA(0,1,1)(0,1,1)~12~**

Dado bruto: $X_{t}$

Dado logaritmizado: $Y_{t} = lnX_{t}$

Operador de defasagem: $B^{k}Y_{t}=Y_{t-k}$

Termo de erro: $\{u_{t}\} \sim NIID(0,1)$

$$(1-B)\left(1-B^{12}\right)Y_{t}=\left(1-\theta_{1}B\right)
\left(1-\psi_{1}B^{12}\right)u_{t}$$

$$Y_{t} - Y_{t-1} - \left(Y_{t-12}-Y_{t-13}\right)=
u_{t}-\theta_{1}u_{t-1}-\psi_{1}u_{t-2}+\theta_{1}\psi_{1}u_{t-13}$$

$$W_{t}=\epsilon_{t}$$

As autocorrelações são calculadas com $W_{t}$.

O estimador pontual de $Y$ com $h$ passos a diante segue o formato de $W_{t}$.

```{r eval=TRUE, echo=FALSE, out.width="90%", fig.cap="Modelo SARIMA"}
knitr::include_graphics("SARIMA.png")
```

**How to Configure SARIMA** (https://machinelearningmastery.com/sarima-for-time-series-forecasting-in-python/)

Configuring a SARIMA requires selecting hyperparameters for both the trend and seasonal elements of the series.

_Trend Elements_

There are three trend elements that require configuration.

They are the same as the ARIMA model; specifically:

p: Trend autoregression order.

d: Trend difference order.

q: Trend moving average order.

_Seasonal Elements_

There are four seasonal elements that are not part of ARIMA that must be configured; they are:

P: Seasonal autoregressive order.

D: Seasonal difference order.

Q: Seasonal moving average order.

s: The number of time steps for a single seasonal period.

# Modelo ARIMA

```{r eval=TRUE, echo=FALSE, out.width="90%", fig.cap="Velicer & Fava (2003)"}
knitr::include_graphics("ARIMA8.png")
```

```{r eval=TRUE, echo=FALSE, out.width="90%", fig.cap="Velicer & Fava (2003)"}
knitr::include_graphics("ARIMA.png")
```

* White noise (ruído branco) = ARIMA(0,0,0)
* Random walk (passeio aleatório) = ARIMA(0,1,0) 
* Basic exponential smoothing = ARIMA(0,1,1)
* Brown = ARIMA(0,2,2)
* Holt ou double exponential smoothing = ARIMA(0,2,2)
* Damped Holt = ARIMA(0,1,2)
* Damped-Trend = ARIMA(1,1,2)
* Simple Seasonal = ARIMA(0,1,(1,s,s+1))(0,1,0)
* Winters’ Additive = ARIMA(0,1,s+1)(0,1,0)
* Winters’ Multiplicative = não-ARIMA

# Análise de função de transferência

A análise de função de transferência generaliza a análise de intervenção, pois uma extensão natural no modelo de intervenção é permitir que a série independente seja diferente de uma variável dicotômica (_dummy_) determinística.

Na ausência de retroalimentação (_feedback_), a análise de função de transferência pode ser útil para previsão e teste de hipótese sobre a relação entre duas séries.

# Vestuário masculino por catálogo

> IBM SPSS Forecasting, 2014

Uma empresa que opera por meio de catálogo, que está interessada em desenvolver um modelo de previsão, coletou dados sobre vendas mensais entre janeiro de 1989 e dezembro de 1998 de vestuário masculino juntamente com algumas séries que podem ser usadas para explicar a variação nas vendas. 

Possíveis preditores são a quantidade de catálogos enviados pelo correio, a quantidade de páginas do catálogo, a quantidade de linhas telefônicas abertas para pedidos, o montante gasto em propaganda impressa e quantidade de atendentes do serviço de venda por catálogo. 

Esses preditores são úteis para prever as vendas por catálogo de vestuário masculino?

**Observação: antes de converter a variável de data, o arquivo deve ser ordenado cronologicamente.**

```{r eval=TRUE, echo=TRUE}
# Regression with ARIMA errors in R
# https://otexts.com/fpp2/regarima.html
# https://robjhyndman.com/acemsforecasting2018/3-Dynamic-Regression.pdf
Dados <- readxl::read_excel("catalog_seasfac_men.xlsx")
Dados$date <- as.Date(Dados$date)
Dados <- timeSeries::timeSeries(data=Dados[,2:5], 
                                charvec=Dados$date,
                                title="Venda de vestuario masculino por 
                                catalogo: 1989-98")

plot(Dados, main="Sales of Men's Clothing: 1989-98")
plot(Dados$phone, Dados$men)
cor.test(Dados$phone, Dados$men)
plot(Dados$mail, Dados$men)
cor.test(Dados$mail, Dados$men)
plot(Dados$page, Dados$men)
cor.test(Dados$page, Dados$men)
forecast::tsoutliers(Dados$men)
forecast::tsoutliers(Dados$phone) # Number of Phone Lines Open for Ordering
forecast::tsoutliers(Dados$mail) # Number of Catalogs Mailed
forecast::tsoutliers(Dados$page) # Number of Pages in Catalog
# Lambda <- forecast::BoxCox.lambda(Dados)
# ARIMAX model
xreg <- cbind(Dados$mail, Dados$page, Dados$phone)
colnames(xreg) <- c("mail", "page", "phone")
fitauto <- forecast::auto.arima(Dados$men,
                                lambda=1, # Box-Cox transformation
                                xreg=xreg)
summary(fitauto)
lmtest::coeftest(fitauto)
Box.test(fitauto$residuals)

xreg <- cbind(Dados$mail, Dados$phone)
colnames(xreg) <- c("mail", "phone")
# IBM SPSS 26: Time Series Modeler: Expert Modeler Criteria
fit <- forecast::Arima(Dados$men,
                       order=c(0,0,0),
                       seasonal=list(order=c(0,1,0),period=12),
                       lambda=1, # Box-Cox transformation
                       xreg=xreg)
summary(fit)
lmtest::coeftest(fit)
Box.test(fit$residuals)
plot(Dados$men, type="l", col="black", lwd=2, 
main="diff(Dados$men,12)~
      diff(Dados$mail,12)+diff(Dados$phone,12)
      Observed=black Fit=blue")
lines(fit$fitted, type="l", col="blue")
summary(estimatr::lm_robust(diff(Dados$men,12)~
                              diff(Dados$mail,12)+diff(Dados$phone,12)))
fitauto <- forecast::auto.arima(Dados$men, 
                                lambda=1, # Box-Cox transformation
                                xreg=xreg)
summary(fitauto)
lmtest::coeftest(fitauto)
Box.test(fitauto$residuals)

xreg <- cbind(Dados$phone)
colnames(xreg) <- c("phone")
fitauto <- forecast::auto.arima(Dados$men, 
                                lambda=1, # Box-Cox transformation
                                xreg=xreg)
summary(fitauto)
lmtest::coeftest(fitauto)
Box.test(fitauto$residuals)

xreg <- cbind(Dados$mail)
colnames(xreg) <- c("mail")
fitauto <- forecast::auto.arima(Dados$men, 
                                lambda=1, # Box-Cox transformation
                                xreg=xreg)
summary(fitauto)
lmtest::coeftest(fitauto)
Box.test(fitauto$residuals)
```

# Melanoma & Mancha Solar

"Houghton, Munster e Viola (1978) mostraram que a taxa de incidência de melanoma maligno ajustada à idade no estado de Connecticut aumentou desde 1935 e que se sobrepõe ao aumento são períodos de 3-5 anos em que o aumento na taxa de incidência é excessivo. 

Esses períodos têm um ciclo de 8 a 11 anos e seguem períodos de atividade máxima das manchas solares. 

A relação entre os ciclos solares e o melanoma sustenta a hipótese de que o melanoma está relacionado à exposição solar e fornece evidências de que a radiação solar pode desencadear o desenvolvimento de melanoma clinicamente aparente."

> Andrews & Herzberger, 1985, 199

```{r eval=TRUE, echo=FALSE, out.width="70%", fig.cap="Andrews & Herzberger, 1985"}
knitr::include_graphics("Table32_1.png")
```

```{r eval=TRUE, echo=FALSE, out.width="70%", fig.cap="Houghton et al., 1978"}
knitr::include_graphics("SunspotMelanoma.png")
```

"Este método revela que existem fortes associações numéricas, com correlações > 0.5, entre essas pequenas, mas distintas tendências de longo prazo no ciclo solar e câncer de pele."

```{r eval=TRUE, echo=FALSE, out.width="70%", fig.cap="Valachovic & Zurbenko, 2014"}
knitr::include_graphics("SunspotSkincancer.png")
```

```{r eval=TRUE, echo=FALSE, out.width="70%", fig.cap="Valachovic & Zurbenko, 2014"}
knitr::include_graphics("Figure7.png")
```

> Valachovic & Zurbenko, 2014

Fonte dos dados: 

* Andrews & Herzberger, 1985, 199-201, Incidence of Malignant Melanoma After Peaks of Sunspot Activity

```{r eval=TRUE, echo=TRUE}
Dados <- readxl::read_excel("Melanoma.xlsx")
Dados$Year <- as.Date(Dados$Year)
Dados <- timeSeries::timeSeries(data=Dados[,2:4], 
                                charvec=Dados$Year,
                                title="Age-adjusted incidence of malignant 
                                melanoma in the State of Connecticut
                                per 100 000 persons")
Dados <- cbind(Dados,diff(log(Dados$Male)))
Dados <- cbind(Dados,log(Dados$Sunspot))
colnames(Dados) <- c("Male", "Total", "Sunspot", "MaleDiffLn", "SunspotLn")
print(Dados)
plot(Dados)
ggplot2::autoplot(Dados)
plot(Dados$MaleDiffLn, type="l", ylab="")
lines(Dados$SunspotLn/10, type="l", lty=2, lwd=2)
legend("topright", legend=c("MenDiffLn","SunspotLn"), lty=c(1,2), bty="n")

plot(Dados$MaleDiffLn, Dados$SunspotLn)
cor.test(Dados$MaleDiffLn, Dados$SunspotLn)
forecast::tsoutliers(Dados$Male)
forecast::tsoutliers(Dados$Sunspot)
fitauto <- forecast::auto.arima(Dados$Male,
                                lambda=0, # Box-Cox transformation
                                xreg=Dados$Sunspot)
summary(fitauto)
lmtest::coeftest(fitauto)
Box.test(fitauto$residuals)
```

Fonte dos dados:

National Cancer Institute: https://nccrexplorer.ccdi.cancer.gov/

* Melanoma of the Skin
* Recent Trends in SEER Age-Adjusted Incidence Rates, 2004-2019
* By Sex, Observed SEER Incidence Rate, Non-Hispanic White, Ages 40-64, Localized

Solar Influences Data Analysis Center: http://www.sidc.oma.be/

```{r eval=TRUE, echo=TRUE}
Dados <- readxl::read_excel("Melanoma_Sex.xlsx", sheet="Melanomale")
Dados$Year <- as.Date(Dados$Year)
Dados <- timeSeries::timeSeries(data=Dados[,2:3], 
                                charvec=Dados$Year,
                                title="Age-adjusted incidence of malignant 
                                melanoma in the USA")
Dados <- cbind(Dados,log(Dados$Sunspot))
Dados <- cbind(Dados,diff(log(Dados$Melanoma.Male)))
colnames(Dados) <- c("Sunspot", "Melanoma.Male", "SunspotLn", "Melanoma.MaleDiffLn")
print(Dados)
plot(Dados)
ggplot2::autoplot(Dados)
plot(Dados$Melanoma.MaleDiffLn, type="l", ylab="")
lines(Dados$Sunspot/1000, type="l", lty=2, lwd=2)
legend("topright", legend=c("Melanoma.MaleDiffLn","SunspotLn"), 
       lty=c(1,2), bty="n")

plot(Dados$Melanoma.MaleDiffLn, Dados$SunspotLn)
cor.test(Dados$Melanoma.MaleDiffLn, Dados$SunspotLn)
forecast::tsoutliers(Dados$Melanoma.MaleDiffLn)
forecast::tsoutliers(Dados$Sunspot)
fitauto <- forecast::auto.arima(Dados$Melanoma.Male,
                                lambda=0, # Box-Cox transformation
                                xreg=Dados$Sunspot)
summary(fitauto)
lmtest::coeftest(fitauto)
Box.test(fitauto$residuals)
```

# Câncer pulmonar & Mancha Solar

"Câncer pulmonar. 

Os pacientes com câncer pulmonar registrados investigados totalizaram 1.133 pessoas com 969 homens e 164 mulheres, incluindo câncer pulmonar em diferentes posições como pulmão esquerdo, pulmão direito, folha superior, folha inferior, centro do pulmão, periferia do pulmão e brônquios e câncer pulmonar de diferentes tipos, como adenocarcinoma de pulmão, carcinoma de células alveolares de pulmão e carcinoma de células escamosas. 

Comparar a curva de distribuição dos anos de nascimento para os pacientes com câncer de pulmão com a curva de variação periódica da atividade solar, eles têm a mesma semelhança com o câncer gástrico e hepático.

A curva de distribuição do ano de nascimento nos anos de 1926 a 1950 para os pacientes com câncer de pulmão tem uma inter-relação óbvia com a curva de variação periódica da atividade solar (Fig. 4). 

Os picos da curva de distribuição do ano de nascimento aparecem nos segmentos de pico e vale da curva de variação periódica da atividade solar, enquanto o número de pacientes com câncer de pulmão, que nasceram nos anos com atividade solar moderada como sunpots entre cerca de 20 a 70, também diminui significativamente. Pelo tratamento estatístico do teste t, a diferença entre eles é significativa com p<0.05. 

Somente entre os anos de 1939 e 1942, a curva decrescente do número de pacientes com câncer de pulmão é muito acentuada, e o pico entre 1942 e 1944 é muito baixo. 

Possivelmente, isso se deve ao fato de que as pessoas nascidas nestes anos tinham em torno de 50 anos de idade, que se encontra em um estágio de transição de baixa para alta morbidade para o câncer de pulmão, e o número de pacientes é mais afetado pelo fator idade."

```{r eval=TRUE, echo=FALSE, out.width="70%", fig.cap="Valachovic & Zurbenko, 2014"}
knitr::include_graphics("Fig4.png")
```

> Zhang et al., 1993

Fonte dos dados:

National Cancer Institute: https://nccrexplorer.ccdi.cancer.gov/

* Adenocarcinoma of the Lung and Bronchus
* Long-Term Trends in SEER Age-Adjusted Incidence Rates, 1975-2019
* Observed SEER Incidence Rate By Sex, White (includes Hispanic), Ages 40-64

Solar Influences Data Analysis Center: http://www.sidc.oma.be/

```{r eval=TRUE, echo=TRUE}
Dados <- readxl::read_excel("Lung_Sex.xlsx", sheet="LungMen")
Dados$Year <- as.Date(Dados$Year)
Dados <- timeSeries::timeSeries(data=Dados[,2:3], 
                                charvec=Dados$Year,
                                title="Age-adjusted incidence of Lung cancer
                                in USA")
Dados <- cbind(Dados,diff(log(Dados$Lung)))
Dados <- cbind(Dados,diff(log(Dados$Sunspot)))
colnames(Dados) <- c("Sunspot", "Lung", "LungDiffLn", "SunspotDiffLn")
print(Dados)
plot(Dados)
ggplot2::autoplot(Dados)
plot(Dados$LungDiffLn, type="l", ylab="")
lines(Dados$SunspotDiffLn/10, type="l", lty=2, lwd=2)
legend("top", legend=c("LungDiffLn","SunspotDiffLn"), lty=c(1,2), bty="n")

plot(Dados$LungDiffLn, Dados$SunspotDiffLn)
cor.test(Dados$LungDiffLn, Dados$SunspotDiffLn)
forecast::tsoutliers(Dados$Lung)
forecast::tsoutliers(Dados$Sunspot)
fitauto <- forecast::auto.arima(Dados$Lung,
                                lambda=0, # Box-Cox transformation
                                xreg=Dados$Sunspot)
summary(fitauto)
lmtest::coeftest(fitauto)
Box.test(fitauto$residuals)
```

# Câncer pulmonar & Tabagismo

"Ao discutir suas descobertas, Doll e Hill raciocinaram cuidadosamente ao pesar as evidências a favor e contra o tabagismo como “um fator importante na causa do carcinoma do pulmão”. "

Schlesselman, 2006, p. 254

"Calculamos os riscos de morte por tabagismo a longo prazo para indivíduos de várias idades e status de tabagismo em termos do excesso de mortalidade contribuído pelo tabagismo, além da mortalidade basal pelas mesmas doenças causadas por outros fatores que não o tabagismo, usando procedimentos de tabela de vida padrão. 

Como os dados de mortalidade para categorias específicas de fumantes estavam disponíveis apenas em estudos prospectivos no final da década de 1950, nós os escalamos para os níveis de mortalidade de 1982. 

Assumimos, para câncer de pulmão, que as taxas de mortalidade para não fumantes não mudaram e, para outras doenças relacionadas ao tabagismo, que os riscos de morte para fumantes em relação aos não fumantes não mudaram desde a década de 1950. 

Probabilidades que resultam de hipóteses alternativas também foram investigadas e são apresentadas. 

Cerca de um terço dos fumantes pesados de 35 anos morrerão antes dos 85 anos de doenças causadas pelo tabagismo. 

As probabilidades de morte por tabagismo quando comparadas com outras causas podem ser persuasivas como ferramentas de educação pública. 

Seu uso efetivo para esse fim é afetado não apenas pelas deficiências no conhecimento factual do público sobre a magnitude dos riscos do tabagismo, mas também por vários aparentes equívocos relacionados à interpretação das informações de risco. 

Os dados de risco devem ser apresentados ao público de uma maneira que esclareça esses equívocos e facilite sua compreensão do risco esmagador imposto pelo tabagismo."

> Mattson et al., 1987, resumo

```{r eval=TRUE, echo=FALSE, out.width="70%", fig.cap="Hecht, 1999"}
knitr::include_graphics("RatSmoke.png")
```

```{r eval=TRUE, echo=FALSE, out.width="70%", fig.cap="Schlesselman, 2006"}
knitr::include_graphics("Fig1.png")
```

```{r eval=TRUE, echo=FALSE, out.width="70%", fig.cap="Mattson et al., 1987"}
knitr::include_graphics("Table1.png")
```

```{r eval=TRUE, echo=FALSE, out.width="70%", fig.cap="Mattson et al., 1987"}
knitr::include_graphics("Table3.png")
```

Fonte dos dados:

National Cancer Institute: https://nccrexplorer.ccdi.cancer.gov/

* Adenocarcinoma of the Lung and Bronchus
* Long-Term Trends in SEER Age-Adjusted Incidence Rates, 1975-2019
* Observed SEER Incidence Rate By Sex, White (includes Hispanic), Ages 40-64

American Lung Association: https://www.lung.org/research/trends-in-lung-disease/tobacco-trends-brief/data-tables/ad-cig-smoke-rate-sex-race-age

* Percent of Adults Who Smoked >24 Cigarettes Daily by Sex, Race, Hispanic Origin, Age and Education

```{r eval=TRUE, echo=TRUE}
Dados <- readxl::read_excel("Lung_Sex.xlsx", sheet="LungMenSmoke24")
Dados$Year <- as.Date(Dados$Year)
Dados <- timeSeries::timeSeries(data=Dados[,2:3], 
                                charvec=Dados$Year,
                                title="Age-adjusted incidence of Lung cancer
                                in USA")
Dados <- cbind(Dados,diff(log(Dados$Lung)))
Dados <- cbind(Dados,diff(log(Dados$Smoke)))
colnames(Dados) <- c("Lung", "Smoke", "LungDiffLn", "SmokeDiffLn")
print(Dados)
plot(Dados)
ggplot2::autoplot(Dados)
plot(Dados$LungDiffLn, type="l", ylab="", ylim=c(-.3,.2))
lines(Dados$SmokeDiffLn, type="l", lty=2, lwd=2)
legend("topleft", legend=c("LungDiffLn","SunspotDiffLn"), lty=c(1,2), bty="n")

plot(Dados$LungDiffLn, Dados$SmokeDiffLn)
cor.test(Dados$LungDiffLn, Dados$SmokeDiffLn)
forecast::tsoutliers(Dados$Lung)
forecast::tsoutliers(Dados$Smoke)
fitauto <- forecast::auto.arima(Dados$Lung,
                                lambda=0, # Box-Cox transformation
                                xreg=Dados$Smoke)
summary(fitauto)
lmtest::coeftest(fitauto)
Box.test(fitauto$residuals)
```

# Análise de intervenção

```{r eval=TRUE, echo=FALSE, out.width="70%", fig.cap="Velicer & Fava, 2003"}
knitr::include_graphics("Intervention.png")
```

"Em seguida, estudamos o número mensal de motoristas mortos de veículos leves na Grã-Bretanha entre janeiro de 1969 e dezembro de 1984 mostrado na Figura 3. 

Esta série temporal é parte de um conjunto de dados que foi considerado pela primeira vez por Harvey e Durbin (1986) para estudar o efeito de uso obrigatório do cinto de segurança introduzido em 31 de janeiro de 1983. 

O conjunto de dados, incluindo covariáveis adicionais, está disponível em R no objeto Seatbelts. Em seu artigo Harvey e Durbin (1986) analisam os números de acidentes para motoristas e passageiros de carros, que são tão grandes que podem ser tratados com métodos para dados de valor contínuo. 

O número mensal de motoristas mortos de vans analisados aqui é muito menor (seu mínimo é 2 e seu máximo 17) e, portanto, métodos para dados de contagem devem ser preferidos.

Para a seleção do modelo, usamos apenas os dados até dezembro de 1981."

> Liboschik et al., 2017, p. 18

```{r eval=TRUE, echo=FALSE, out.width="70%", fig.cap="Liboschik et al., 2017"}
knitr::include_graphics("Obitos.png")
```

```{r eval=TRUE, echo=TRUE}
timeseries <- Seatbelts[, "VanKilled"]
str(timeseries)
print(timeseries)
plot(timeseries,
     xlab="Mes",  ylab="Numero de obitos", 
     main="Monthly number of killed van drivers in Great Britain",
     col="black")
cpm <- changepoint::cpt.mean(timeseries)
summary(cpm)
plot(cpm)
ggplot2::autoplot(cpm)
cpv <- changepoint::cpt.var(timeseries)
summary(cpv)
plot(cpv)
ggplot2::autoplot(cpv)
sc <- strucchange::breakpoints(timeseries~1)
print(sc)
ggplot2::autoplot(sc)
regressors <- cbind(PetrolPrice = Seatbelts[, c("PetrolPrice")],
                    linearTrend = seq(along = timeseries)/12)
timeseries_until1981 <- window(timeseries, end = 1981 + 11/12)
regressors_until1981 <- window(regressors, end = 1981 + 11/12)
seatbeltsfit <- tscount::tsglm(timeseries_until1981,
                               model = list(past_obs = c(1, 12)), 
                               link = "log", 
                               distr = "poisson",
                               xreg = regressors_until1981)
summary(seatbeltsfit)
lmtest::coeftest(seatbeltsfit)
timeseries_1982 <- window(timeseries, start = 1982, end = 1982 + 11/12)
regressors_1982 <- window(regressors, start = 1982, end = 1982 + 11/12)
predict(seatbeltsfit, 
        n.ahead = 12, 
        level = 0.9, 
        global = TRUE,
        B = 2000, 
        newxreg = regressors_1982)$pred
seatbeltsfit_alldata <- tscount::tsglm(timeseries, 
                                       link = "log",
                                       model = list(past_obs = c(1, 12)), 
                                       xreg = regressors, 
                                       distr = "poisson")
tscount::interv_test(seatbeltsfit_alldata, 
                     tau = 170, 
                     delta = 1, 
                     est_interv = TRUE)
```

"With a p value of 0.29 the null hypothesis of no intervention cannot be rejected at a 5% significance level." 

> Liboschik et al., 2017, p. 21

# Sequência em R

```{r}
seq(3) 
# 1 2 3
seq(from=3)
# 1 2 3
seq(length.out=3)
# 1 2 3
seq(from=-3, to=3) 
# -3 -2 -1  0  1  2  3
seq(from=-2, to=2, by=0.5)
# -2.0 -1.5 -1.0 -0.5  0.0  0.5  1.0  1.5  2.0
seq(from=-10, to=10, along=1:5)
# -10  -5   0   5  10
seq(from=-10, to=10, along=1:9)
# -10.0  -7.5  -5.0  -2.5   0.0   2.5   5.0   7.5  10.0
seq(from=0, to=1, length.out=6)
# 0.0 0.2 0.4 0.6 0.8 1.0

# geometric progression
2^seq(from=0, to=5, by=1)
# 1  2  4  8 16 32
geomSeries <- function(base, max){
  base^(0:floor(log(max, base)))
}
geomSeries(base=2, max=50)
# 1  2  4  8 16 32
geomSeq <- function(start,ratio,begin,end){
  begin<-begin-1
  end<-end-1
  start*ratio**(begin:end)
}
geomSeq(1, 2, 1, 6)
# 1  2  4  8 16 32
geomSeq(1, 2, 3, 6)
# 4  8 16 32

# first day of year series
seq(as.Date("2018/1/1"), as.Date("2021/1/1"), by="years")
# "2018-01-01" "2019-01-01" "2020-01-01" "2021-01-01"

# month series
seq(as.Date("2000/1/1"), by="month", length=12)
# [1] "2000-01-01" "2000-02-01" "2000-03-01" "2000-04-01"
# [5] "2000-05-01" "2000-06-01" "2000-07-01" "2000-08-01"
# [9] "2000-09-01" "2000-10-01" "2000-11-01" "2000-12-01"

# quarter series
seq(as.Date("2000/1/1"), as.Date("2001/1/1"), by="3 months")
# [1] "2000-01-01" "2000-04-01" "2000-07-01" "2000-10-01"
# [5] "2001-01-01"

# week series
seq(as.Date("2001/1/1"), as.Date("2001/3/1"), by="weeks")
# [1] "2001-01-01" "2001-01-08" "2001-01-15" "2001-01-22"
# [5] "2001-01-29" "2001-02-05" "2001-02-12" "2001-02-19"
# [9] "2001-02-26"

# day series
seq(as.Date("2001/1/1"), as.Date("2001/1/31"), by="days")
# [1] "2001-01-01" "2001-01-02" "2001-01-03" "2001-01-04"
# [5] "2001-01-05" "2001-01-06" "2001-01-07" "2001-01-08"
# [9] "2001-01-09" "2001-01-10" "2001-01-11" "2001-01-12"
# [13] "2001-01-13" "2001-01-14" "2001-01-15" "2001-01-16"
# [17] "2001-01-17" "2001-01-18" "2001-01-19" "2001-01-20"
# [21] "2001-01-21" "2001-01-22" "2001-01-23" "2001-01-24"
# [25] "2001-01-25" "2001-01-26" "2001-01-27" "2001-01-28"
# [29] "2001-01-29" "2001-01-30" "2001-01-31"

# first four months
cat(month.name[1:4], sep=" ")
# January February March April

# first four months
cat(month.name[1:4], sep="-")
# January-February-March-April

# first four months
cat(month.name[1:4], sep="")
# JanuaryFebruaryMarchApril

cat("Statistics", "in R") # Statistics in R
cat("Statistics", "in R", file="output.txt")

outer(month.abb, 1999:2003, FUN="paste")

rep(x=1, times=2)
# 1 1 
rep(x=c(4, 3), times=2)
# 4 3 4 3
rep(x=c(4, 3), times=c(2,5))
# 4 4 3 3 3 3 3
rep(x=c(4, 3), each=2)
# 4 4 3 3

rep(x="a", times=2)
# "a" "a" 
rep(x=c("a", "b"), times=2)
# "a" "b" "a" "b"
rep(x=c("a", "b"), times=c(2,5))
# "a" "a" "b" "b" "b" "b" "b"
rep(x=c("a", "b"), each=2)
# "a" "a" "b" "b"

paste(1:6) 
# "1" "2" "3" "4" "5" "6"
paste(1:5, c("st", "nd", "rd", rep("th", 2)))
# "1 st" "2 nd" "3 rd" "4 th" "5 th"
paste0(1:5, c("st", "nd", "rd", rep("th", 2)))
# "1st" "2nd" "3rd" "4th" "5th"
paste0(1:5, c("st", "nd", "rd", rep("th", 2)),
       collapse=", ")
# "1st, 2nd, 3rd, 4th, 5th"
paste("Q", 1:6, sep="")
# "Q1" "Q2" "Q3" "Q4" "Q5" "Q6"
paste0("Q", 1:6)
# "Q1" "Q2" "Q3" "Q4" "Q5" "Q6"
paste("Today is", date())
# "Today is Mon Nov 08 18:27:11 2021"
paste0("Today is ", date())
# "Today is Mon Nov 08 18:27:11 2021"
paste0("Q", 1:6, collapse="+")
paste0("F~",paste0("Q", 1:6, collapse="+"))
paste0("F~",paste0("Q", 1:6, collapse="+"), "\n",
       "G~",paste0("Q", 7:9, collapse="+"))

n <- 1e6
z <- stats::rnorm(n)
table(cut(z, breaks=-6:6))
table(cut(z, breaks=-6:6))/n

aaa <- c(1,2,3,4,5,2,3,4,5,6,7)
cut(aaa, 3)
cut(aaa, 3, dig.lab = 3, ordered_result = TRUE)

## one way to extract the breakpoints
labs <- levels(cut(aaa, 3))
cbind(lower = as.numeric( sub("\\((.+),.*", "\\1", labs) ),
      upper = as.numeric( sub("[^,]*,([^]]*)\\]", "\\1", labs) ))

## First control, then treatment:
gl(n=2, k=4, labels=c("Control", "Treat"))
# [1] Control Control Control Control Treat   Treat  
# [7] Treat   Treat  
# Levels: Control Treat

## 20 alternating 1s and 2s
gl(n=2, k=1, length=2*4)
# [1] 1 2 1 2 1 2 1 2
# Levels: 1 2

## alternating pairs of 1s and 2s
gl(n=2, k=2, length=2*4)
# [1] 1 1 2 2 1 1 2 2
# Levels: 1 2

gl(n=3, k=4, labels=c("Low", "Medium", "High"),
   ordered=TRUE)
# [1] Low    Low    Low    Low    Medium Medium Medium
# [8] Medium High   High   High   High  
# Levels: Low < Medium < High

```

# Referências

* Andrews, DF & Herzberg, AM (1985) _Data: A collection of problems from many fields for the student and research worker_. NY: Springer-Verlag.
* ANTUNES, JLF e  CARDOSO, MRAs. Uso da análise de séries temporais em estudos epidemiológicos. Epidemiol. Serv. Saúde [online]. 2015, vol.24, n.3 [citado  2023-02-12], pp.565-576. Disponível em: <http://scielo.iec.gov.br/scielo.php?script=sci_arttext&pid=S1679-49742015000300024&lng=pt&nrm=iso>. ISSN 1679-4974.
* Box, GEP, Jenkins, GM, Reinsel, GC, and Ljunt, GM (2015) _Time series analysis: Forecasting and control_. 5th ed. NJ: Wiley.
* Campbell, W et al. (1997) _The econometrics of financial markets_. 2nd ed. NJ: Princeton. 
* Campbell, DT & Stanley, JC (1969) _Delineamentos experimentais e quase-experimentais de pesquisa_. São Paulo: EPU/EDUSP. Capítulo 7: O experimento de série temporal.
* Cunha, GZ (2016) _Modelos de séries temporais para dados de contagem_. Dissertação de mestrado do PBE-UEM. http://pbe.uem.br/wp-content/uploads/2020/03/MODELOS-DE-S%C3%89RIES-TEMPORAIS-PARA-DADOS-DE-CONTAGEM-%E2%80%93-Guilherme-Zubatch-da-Cunha.pdf.
* Enders, W (2015) _Applied econometric time series_. 4th ed. NJ: Wiley. http://time-series.net/.
* Ferreira, PGC et al. (2015) _Box & Jenkins com função de transferência usando o R: um estudo de série de Energia Natural Afluente (ENA) do subsistema sul_. SBPO.
* Furrukh, M (2013) Tobacco smoking and lung cancer: Perception-changing facts. _Sultan Qaboos Univ Med J._ 13(3):345-58. doi: 10.12816/0003255. 
* Hamaker, EL (2013) Why researchers should think “within-person”:  A paradigmatic rationale. In Mehl MR &, Conner TS (Eds.) (2013) _Handbook of research methods for studying daily life_. NY: Guilford. p. 43-61.
* Hamaker EL, Asparouhov T, Brose A, Schmiedek F, Muthén B (2018) At the frontiers of modeling intensive longitudinal data: Dynamic structural equation models for the affective measurements from the COGITO Study. _Multivariate Behav Res_ 53(6):820-41. doi: 10.1080/00273171.2018.1446819.
* Hamilton, JD (1994) _Time series analysis_. NJ: Princeton.
* Hecht, SS (1999) Tobacco Smoke Carcinogens and Lung Cancer. _JNCI: Journal of the National Cancer Institute_ 91(14): 1194–210. https://doi.org/10.1093/jnci/91.14.1194.
* Houghton, A, Munster, EW and Viola, MV (1978). Increased
incidence of malignant melanoma after peaks of sunspot activity.
_The Lancet_ 8: 759-60.
* _IBM SPSS Forecasting 22_ (2014). USA: IBM SPSS.
* Liboschik, T; Fokianos, K & Fried, R (2017). tscount: An R package for analysis of count time series following generalized linear models. _Journal of Statistical Software_, 82(5): 1–51. https://doi.org/10.18637/jss.v082.i05.
* Mair, P (2018) _Modern psychometrics with R_. USA: Springer. Chapter 13: Modeling trajectories and time series; Chapter 14: Analysis of fMRI data.
* Mattson ME, Pollack ES, Cullen JW. (1987) What are the odds that smoking will kill you? _Am J Public Health._ 77(4):425-31. doi: 10.2105/ajph.77.4.425. Erratum in: Am J Public Health 1987 Jul;77(7):818.
* Morgenstern, H (1995) Ecologic studies in epidemiology: concepts, principles, and methods. _Annu Rev Public Health_ 16:61-81. doi: 10.1146/annurev.pu.16.050195.000425.
* Murteira, BJF et al. (1993) _Análise de sucessões cronológicas_. Lisboa: McGraw-Hill. Capítulo 9: Modelos de função de transferência e de intervenção.
* Newbold, P & Bos, T (1990) _Introductory business forecasting_. South-Western.
* Stadnitski, T (2020) Time series analyses with psychometric data. _PLoS ONE_ 15(4): e0231785. https://doi.org/10.1371/journal.
* Morley, S (2018) _Single-case methods in clinical psychology: A practical guide_. NY: Routledge. Chapter 5: Visual analysis if single-case data; Chapter 6: Statistical analysis of single-case data.
* Schaffer AL, Dobbins TA, Pearson SA (2021) Interrupted time series analysis using autoregressive integrated moving average (ARIMA) models: a guide for evaluating large-scale health interventions. _BMC Med Res Methodol_ 21(1):58. doi: 10.1186/s12874-021-01235-8.
* Spata, AV (2005) _Métodos de pesquisa: ciências do comportamento e diversidade humana_. RJ: LTC. Capítulo 13: Delineamentos de sujeito único.
* Schlesselman, JJ (2006) The emerging case-control study: Lung cancer in relation to tobacco smoking. _Preventive Medicine_
43(4): 251-255. https://doi.org/10.1016/j.ypmed.2006.07.014.
* Tsay, RS (2010) _Analysis of financial time series_. 3rd ed. NJ: Wiley. 
* Tsay, RS (2012) _An introduction to analysis of financial data with R_. NJ: Wiley. https://faculty.chicagobooth.edu/ruey-s-tsay/research/an-introduction-to-analysis-of-financial-data-with-r.
* Tsay, RS (2014) _Multivariate time series analysis with R and financial applications_. NJ: Wiley. https://faculty.chicagobooth.edu/ruey-s-tsay/research/multivariate-time-series-analysis-with-r-and-financial-applications.
* Tsay, RS & Chen, R (2018) _Nonlinear time series analysis_. NJ: Wiley. https://faculty.chicagobooth.edu/ruey-s-tsay/research/nonlinear-time-series-analysis.
* Valachovic, E & Zurbenko, I (2014) Skin cancer, irradiation, and sunspots: The solar cycle effect. _BioMed Research International_ 2014. https://doi.org/10.1155/2014/538574.
* Velicer, WF & Fava, JL (2003) Time series analysis. In Schinka, J & Velicer, WF (Eds.), _Research Methods in Psychology_ (581-606). Volume 2, Handbook of Psychology (Weiner, IB Editor-inChief). NY: Wiley.
* Victor-Edema, UA & Essi, DI. A transfer function modelling of Nigerian current account (Net) and exchange rate. _Int J Stat Appl Math_ 5(4): 177-185. DOI: 10.22271/maths.2020.v5.i4c.564.
* Zhang YQ, Xu ZT, Yu QL (1993) The carcinogenic effect of solar activity with different intensities on embryos. _J Radiat Res._ 34(3):240-6. doi: 10.1269/jrr.34.240. Erratum in: J Radiat Res (Tokyo) 1993 Dec;34(4):419. 

* Hyndman, RJ. _The ARIMAX model muddle_. https://robjhyndman.com/hyndsight/arimax/
* Ren, R (2020) _All the confusion about ARIMA, ARIMAX, Transfer Function, Dynamic Regression Models_. https://ruqinren.wordpress.com/2020/02/21/all-the-confusion-about-arima-arimax-transfer-function-dynamic-regression-models/
* _ARIMA Intervention Transfer Function: How to Visualize the Effect_ : https://stats.stackexchange.com/questions/108374/arima-intervention-transfer-function-how-to-visualize-the-effect.